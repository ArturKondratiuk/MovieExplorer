<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="MovieExplorer.Pages.MovieListPage"
    BackgroundColor="{DynamicResource PageBackgroundColor}">

    <!-- local resources -->
    <ContentPage.Resources>
        <ResourceDictionary>

            <!-- light/dark layout -->
            <Color x:Key="SecondaryColor">#FFFFFF</Color>
            <Color x:Key="SecondaryColorDark">#1E1E1E</Color>

            <!-- light/dark text -->
            <Color x:Key="PrimaryTextColor">#000000</Color>
            <Color x:Key="PrimaryTextColorDark">#FFFFFF</Color>

        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- grid -->
    <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto, *"
          Padding="8">

        <!-- searching bar -->
        <SearchBar x:Name="SearchBarControl"
                   Grid.Row="0"
                   Placeholder="Search by title"
                   TextChanged="OnSearchChanged"/>

        <!-- sort and filter buttons -->
        <ScrollView Grid.Row="1"
            Orientation="Horizontal"
            HorizontalScrollBarVisibility="Always"
            Padding="4">
            <HorizontalStackLayout Spacing="8">
                <Button x:Name="YearSortButton"
                Text="Year ↑"
                WidthRequest="110"
                Clicked="OnSortByYear"/>

                <Button x:Name="RatingSortButton"
                Text="Rating ↑"
                WidthRequest="110"
                Clicked="OnSortByRating"/>

                <Button x:Name="GenreFilterButton"
                Text="Genres"
                WidthRequest="110"
                Clicked="OnToggleGenrePanel"/>

                <Button x:Name="DirectorFilterButton"
                Text="Directors"
                WidthRequest="110"
                Clicked="OnToggleDirectorPanel"/>
            </HorizontalStackLayout>
        </ScrollView>

        <!-- genre panel -->
        <ScrollView
            Grid.Row="2"
            x:Name="GenrePanel"
            Orientation="Horizontal"
            IsVisible="False"
            HeightRequest="72"
            BackgroundColor="{DynamicResource PageBackgroundColor}">
            <HorizontalStackLayout x:Name="GenreCheckboxContainer"
                                   Spacing="12"
                                   VerticalOptions="Center"/>
        </ScrollView>


        <!-- director panel -->
        <ScrollView
            Grid.Row="3"
            x:Name="DirectorPanel"
            Orientation="Horizontal"
            IsVisible="False"
            HeightRequest="72"
            BackgroundColor="{DynamicResource PageBackgroundColor}">
            <HorizontalStackLayout x:Name="DirectorCheckboxContainer"
                                   Spacing="12"
                                   VerticalOptions="Center"/>
        </ScrollView>

        <!-- list of movies -->
        <CollectionView
            x:Name="MovieListView"
            Grid.Row="5"
            SelectionMode="None"
            ItemsLayout="VerticalList">

            <CollectionView.ItemTemplate>
                <DataTemplate>

                    <Frame Margin="4"
                           Padding="8"
                           HasShadow="False"
                           CornerRadius="8"
                           BackgroundColor="{DynamicResource SecondaryColor}">

                        <Grid ColumnDefinitions="50, *">

                            <!-- emoji -->
                            <Label Text="{Binding Emoji}"
                                   FontSize="30"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMovieTap"/>
                                </Label.GestureRecognizers>
                            </Label>

                            <!-- movie info -->
                            <VerticalStackLayout Grid.Column="1"
                                                 Spacing="2">

                                <Label Text="{Binding Title}"
                                       FontAttributes="Bold"
                                       FontSize="16"
                                       TextColor="{DynamicResource PrimaryTextColor}">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnMovieTap"/>
                                    </Label.GestureRecognizers>
                                </Label>

                                <Label Text="{Binding YearText}"
                                       FontSize="12"
                                       TextColor="{DynamicResource PrimaryTextColor}"/>

                                <Label Text="{Binding GenreString}"
                                       FontSize="12"
                                       TextColor="{DynamicResource PrimaryTextColor}"/>

                                <Label Text="{Binding RatingDisplay}"
                                       FontSize="12"
                                       TextColor="{DynamicResource PrimaryTextColor}"/>

                            </VerticalStackLayout>
                        </Grid>

                    </Frame>

                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>

</ContentPage>